system profile picture

Okay, let’s continue to significantly enhance your VLCP DApp, focusing on the decentralized chatroom experience and overall user interaction.

This update will primarily focus on:

Gun.js User Authentication (SEA): Implementing Gun.js’s Security, Encryption, Authorization (SEA) module to allow users to create and log in to a Gun.js identity. This is crucial for linking chat messages to persistent, verifiable user identities (aliases) and for future encryption.
User Nicknames: Allow users to set and display unique nicknames in the chat, which are associated with their Gun.js identity.
Enhanced Chatroom UI:
Clearer display of user’s connected wallet, VLCP balance, and allowance.
Improved chat message display with nicknames and timestamps.
More robust feedback for chatroom creation and moderator actions.
Automatic Wallet Data Refresh: Implement a mechanism to automatically update the user’s VLCP balance and allowance when their wallet changes or a new block is mined.
Small UI/UX Tweaks: More visual polish and interaction feedback.
This will make the chatroom much more functional and user-friendly in a decentralized context.

New index.html (Massively Enhanced with Gun.js SEA & Nicknames)
This file will be even larger than before. Please use the Pastebin link for reliable copying.

Key Changes in index.html:

Gun.js SEA Integration: window.SEA is now used for key generation and user authentication.
User Context for Gun: The ChatroomsPage now manages a userPair (Gun.js identity) and userAlias.
Nickname Management: Users can set a nickname, which is stored in Gun under their public key.
Chat Message Format: Messages now include the alias of the sender.
Automatic Wallet Balance/Allowance Updates: ethers.js provider.on('block') and window.ethereum.on('accountsChanged') listeners are implemented.
Refined UI elements: For wallet connection, token management, and chat display.

html

Copy block


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VLCP – Virtual Learning & Community Platform</title>

    <!-- 1. Google Fonts Imports (for all 4 combinations) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Montserrat:wght@400;600;700&family=Noto+Sans:wght@400;600;700&family=Open+Sans:wght@400;600;700&family=Outfit:wght@400;600;700&family=Playfair+Display:wght@700;900&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- 2. EMBEDDED CSS STYLES -->
    <style>
        /* Core Brand Colors (Updated based on VLCP Logo) */
        :root {
            --vlcp-blue-dark: #1A3A70;
            --vlcp-gold: #D4AF37;
            --vlcp-blue-light: #2A5288;
            --vlcp-white: #FFFFFF;
            --vlcp-off-white: #F0F2F5;

            /* Re-mapping existing variables to new VLCP palette */
            --primary-color: var(--vlcp-blue-dark);
            --secondary-color: var(--vlcp-gold);
            --danger-color: #E8083E;
            --success-color: #02864A;
            --neutral-color: #1C1A27;

            /* Theme-specific variables */
            --text-color: var(--vlcp-dark-text);
            --background-color: var(--vlcp-background);
            --card-background: var(--vlcp-card-bg);
            --border-color: var(--vlcp-border);
            --shadow-color: var(--vlcp-shadow);
            --accent-glow: var(--vlcp-accent-glow);
            --chatbot-bg: var(--vlcp-chatbot-bg);
            --chatbot-border: var(--vlcp-chatbot-border);
            --chatbot-message-user: var(--vlcp-message-user);
            --chatbot-message-bot: var(--vlcp-message-bot);
            --chatbot-message-bot-text: var(--vlcp-message-bot-text);

            /* --- FONT COMBINATION DEFAULTS (CHANGE BELOW TO SWITCH) --- */
            --font-heading-primary: 'Poppins', sans-serif;
            --font-heading-secondary: 'Lato', sans-serif;
            --font-body: 'Lato', sans-serif;
        }

        /* --- FONT COMBINATION OPTIONS --- */
        /* To switch, replace the --font-heading-primary, --font-heading-secondary, --font-body
           variables in the :root section above with one of these sets. */

        /* Combination 1: Modern & Energetic (Default) */
        /*
        --font-heading-primary: 'Poppins', sans-serif;
        --font-heading-secondary: 'Lato', sans-serif;
        --font-body: 'Lato', sans-serif;
        */

        /* Combination 2: Elegant & Authoritative */
        /*
        --font-heading-primary: 'Playfair Display', serif;
        --font-heading-secondary: 'Montserrat', sans-serif;
        --font-body: 'Open Sans', sans-serif;
        */

        /* Combination 3: Warm & Approachable */
        /*
        --font-heading-primary: 'Montserrat', sans-serif;
        --font-heading-secondary: 'Open Sans', sans-serif;
        --font-body: 'Noto Sans', sans-serif;
        */

        /* Combination 4: Tech-Inspired & Clean */
        /*
        --font-heading-primary: 'Outfit', sans-serif;
        --font-heading-secondary: 'Poppins', sans-serif;
        --font-body: 'Open Sans', sans-serif;
        */

        /* Basic Reset & Box Sizing */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* Base Styles */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: var(--font-body);
            transition: background-color 0.8s ease, color 0.8s ease;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            font-size: 16px;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading-primary);
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 0.8em;
            color: var(--primary-color);
        }
        h1 { font-size: clamp(2.5rem, 5vw, 4rem); }
        h2 { font-size: clamp(2rem, 4vw, 3.2rem); }
        h3 { font-size: clamp(1.5rem, 3vw, 2.5rem); }


        .app-header h1, .page-section h2 {
            font-family: var(--font-heading-primary);
            font-weight: 700;
        }
        .main-nav button, .theme-toggle {
            font-family: var(--font-heading-secondary);
        }
        .hero-section p, .page-section p, .page-section ul li, .chatbot-message {
            font-family: var(--font-body);
        }

        #root {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            width: 100%;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* Theme Definitions */
        body.light-theme {
            --vlcp-background: var(--vlcp-off-white);
            --vlcp-dark-text: var(--primary-color);
            --vlcp-card-bg: var(--vlcp-white);
            --vlcp-border: #DDDDDD;
            --vlcp-shadow: rgba(0, 0, 0, 0.08);
            --vlcp-accent-glow: rgba(212, 175, 55, 0.25);
            --vlcp-chatbot-bg: #f8f8f8;
            --vlcp-chatbot-border: #e0e0e0;
            --vlcp-message-user: #e6e6e6;
            --vlcp-message-bot: var(--primary-color);
            --vlcp-message-bot-text: var(--vlcp-white);
        }

        body.dark-theme {
            --vlcp-background: var(--neutral-color);
            --vlcp-dark-text: var(--vlcp-off-white);
            --vlcp-card-bg: #2A273B;
            --vlcp-border: #3C384F;
            --vlcp-shadow: rgba(0, 0, 0, 0.5);
            --vlcp-accent-glow: rgba(212, 175, 55, 0.4);
            --vlcp-chatbot-bg: #221F2F;
            --vlcp-chatbot-border: #3A364C;
            --vlcp-message-user: #3C384F;
            --vlcp-message-bot: var(--primary-color);
            --vlcp-message-bot-text: var(--vlcp-white);
        }


        /* Header & Navigation */
        .app-header {
            background-color: var(--card-background);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px var(--vlcp-shadow);
            z-index: 10;
            position: sticky;
            top: 0;
        }

        .app-header .logo {
            height: 50px;
            cursor: pointer;
            transition: transform 0.3s ease-out;
        }
        .app-header .logo:hover {
            transform: scale(1.05) rotate(-3deg);
        }

        .main-nav {
            display: flex;
            gap: 1.5rem;
        }

        .main-nav button {
            background: none;
            border: none;
            color: var(--text-color);
            font-weight: 600;
            padding: 0.5rem 0;
            position: relative;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .main-nav button:hover {
            color: var(--secondary-color);
        }

        .main-nav button::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 0;
            background-color: var(--secondary-color);
            transition: width 0.3s ease-in-out;
        }

        .main-nav button.active::after {
            width: 100%;
            background-color: var(--primary-color);
        }

        .theme-toggle {
            background-color: var(--secondary-color);
            color: var(--vlcp-white);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-weight: 500;
        }

        .theme-toggle:hover {
            background-color: var(--vlcp-blue-light);
            transform: scale(1.05);
        }

        /* Hamburger Menu (Mobile Only) */
        .hamburger-menu {
            display: none;
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--primary-color);
            cursor: pointer;
            z-index: 11;
        }

        .mobile-nav-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--card-background);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .mobile-nav-overlay.open {
            display: flex;
            opacity: 1;
            pointer-events: auto;
        }
        .mobile-nav-overlay .main-nav {
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .mobile-nav-overlay .main-nav button {
            font-size: 1.5rem;
            padding: 1rem 0;
            width: 80%;
            text-align: center;
        }
        .mobile-nav-overlay .theme-toggle {
            font-size: 1.2rem;
            padding: 0.8rem 1.5rem;
        }


        /* Main Content Area */
        .main-content {
            flex-grow: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            position: relative;
            z-index: 2;
            perspective: 1000px;
        }

        /* General Buttons */
        button {
            background-color: var(--primary-color);
            color: var(--vlcp-white);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        button:hover {
            background-color: var(--vlcp-blue-light);
            filter: none;
            transform: translateY(-2px);
        }
        button:active {
            transform: translateY(1px);
        }
        button:disabled {
            background-color: #888;
            cursor: not-allowed;
            transform: none;
        }

        /* 3D Card Styling */
        .card-3d {
            background-color: var(--card-background);
            padding: 2.5rem;
            margin-bottom: 2rem;
            border-radius: 12px;
            box-shadow: 0 8px 20px var(--shadow-color);
            border: 1px solid var(--border-color);
            transform-style: preserve-3d;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            z-index: 5;
        }

        .card-3d:hover {
            transform: rotateX(1deg) rotateY(-1deg) translateZ(10px);
            box-shadow: 0 12px 25px var(--shadow-color);
        }

        .element-3d {
            transform-style: preserve-3d;
            position: relative;
        }

        /* Animated Background Mesh (Enhanced with Parallax) */
        .animated-background-mesh {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.1;
            filter: blur(1px);
            background-size: 100px 100px;
            background-image:
                radial-gradient(circle at 10% 20%, var(--primary-color) 0%, rgba(255, 255, 255, 0) 10%),
                radial-gradient(circle at 90% 80%, var(--secondary-color) 0%, rgba(255, 255, 255, 0) 10%),
                linear-gradient(45deg, var(--background-color) 25%, transparent 25%) -50px -50px,
                linear-gradient(-45deg, var(--background-color) 25%, transparent 25%) -50px -50px,
                linear-gradient(45deg, transparent 75%, var(--background-color) 75%),
                linear-gradient(-45deg, transparent 75%, var(--background-color) 75%);
            will-change: transform;
        }
        body.dark-theme .animated-background-mesh {
            opacity: 0.05;
        }

        /* Dynamic Network Particles */
        .network-particle {
            position: fixed;
            background-color: var(--secondary-color);
            border-radius: 50%;
            opacity: 0;
            z-index: 0;
            pointer-events: none;
        }


        /* Home Page Specifics */
        .hero-section {
            text-align: center;
            padding-top: 3rem;
            padding-bottom: 3rem;
        }

        .hero-section h2 {
            margin-bottom: 1rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .hero-section p {
            font-size: 1.1rem;
            color: var(--text-color);
            margin-bottom: 1.5rem;
        }
        .hero-section strong {
            color: var(--secondary-color);
        }
        .hero-section p strong i {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }

        /* Drag & Drop Zone */
        .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 15px;
            padding: 50px;
            text-align: center;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--secondary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: var(--background-color);
            position: relative;
            overflow: hidden;
            user-select: none;
        }

        .drop-zone.dragging {
            border-color: var(--primary-color);
            background-color: var(--accent-glow);
            color: var(--primary-color);
            box-shadow: 0 0 20px var(--accent-glow);
        }

        .file-icon-simulated {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            pointer-events: none;
            opacity: 0;
        }

        /* File Chunk Simulation */
        .file-chunk-simulated {
            position: fixed;
            border-radius: 50%;
            background-color: var(--primary-color);
            width: 10px;
            height: 10px;
            z-index: 1000;
            pointer-events: none;
        }

        /* Generic Page Section */
        .page-section {
            padding: 2.5rem;
            margin-bottom: 2rem;
            background-color: var(--card-background);
            border-radius: 12px;
            box-shadow: 0 8px 20px var(--shadow-color);
            border: 1px solid var(--border-color);
        }
        .page-section h2, .page-section h3 {
            margin-bottom: 1rem;
            text-align: center;
        }
        .page-section ul {
            list-style: none;
            padding: 0;
            margin-bottom: 1.5rem;
        }
        .page-section ul li {
            background-color: var(--background-color);
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            margin-bottom: 0.7rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .page-section ul li:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .page-section ul li i {
            font-size: 1.2em;
            color: var(--secondary-color);
            min-width: 25px;
            text-align: center;
        }
        .page-section p strong {
            color: var(--secondary-color);
        }
        .page-section em {
            color: var(--primary-color);
        }


        /* Form Styles (for Issuer/Verifier pages and Chatrooms) */
        .common-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            max-width: 500px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--background-color);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px var(--shadow-color);
        }
        .common-form .form-group {
            display: flex;
            flex-direction: column;
        }
        .common-form label {
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        .common-form input, .common-form textarea {
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--card-background);
            color: var(--text-color);
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .common-form input:focus, .common-form textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--accent-glow);
            outline: none;
        }
        .common-form button {
            width: fit-content;
            align-self: center;
            padding: 0.8rem 2rem;
            font-size: 1.1em;
        }
        .common-form .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }
        .common-form .button-group button {
            flex-grow: 1;
            min-width: 150px;
        }


        /* Chatroom Specific Styles */
        .chatrooms-list {
            margin-top: 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        .chatroom-card {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 10px var(--shadow-color);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .chatroom-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px var(--shadow-color);
        }
        .chatroom-card h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }
        .chatroom-card p {
            font-size: 0.9em;
            color: var(--text-color);
            margin-bottom: 1rem;
        }
        .chatroom-card button {
            margin-top: 0.5rem;
            padding: 0.6rem 1.2rem;
            font-size: 0.9em;
        }

        .active-chatroom {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 800px;
            margin: 2rem auto;
            height: 600px;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background-color: var(--card-background);
            box-shadow: 0 4px 15px var(--shadow-color);
            overflow: hidden;
        }
        .chat-messages-display {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            background-color: var(--background-color);
        }
        .chat-message {
            max-width: 80%;
            padding: 0.6rem 1rem;
            border-radius: 12px;
            word-wrap: break-word;
            font-size: 0.95em;
            position: relative;
        }
        .chat-message.self {
            background-color: var(--primary-color);
            color: var(--vlcp-white);
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .chat-message.other {
            background-color: var(--chatbot-message-user);
            color: var(--text-color);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        .chat-message .message-header {
            display: flex;
            align-items: baseline;
            gap: 0.5em;
            margin-bottom: 0.2em;
        }
        .chat-message .message-header strong {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9em;
        }
        .chat-message.self .message-header strong {
            color: var(--vlcp-gold);
        }
        .chat-message .message-header span {
            font-size: 0.7em;
            color: #888;
        }
        .chat-message.self .message-header span {
            color: rgba(255,255,255,0.7);
        }
        .chat-message .message-body {
            font-size: 1em;
        }

        .chat-input-area {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            gap: 0.5rem;
            background-color: var(--card-background);
        }
        .chat-input-area input {
            flex-grow: 1;
            border-radius: 20px;
            padding: 0.7rem 1rem;
        }
        .chat-input-area button {
            border-radius: 20px;
            padding: 0.7rem 1.2rem;
            font-size: 0.9em;
        }

        /* Chatroom Admin/Moderator Section */
        .chatroom-admin-section {
            margin-top: 2rem;
            padding: 2rem;
            background-color: var(--card-background);
            border-radius: 12px;
            box-shadow: 0 4px 15px var(--shadow-color);
            border: 1px solid var(--border-color);
            text-align: center;
        }
        .chatroom-admin-section h3 {
            margin-bottom: 1rem;
        }


        /* Chatbot UI */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background-color: var(--chatbot-bg);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 100;
            border: 1px solid var(--chatbot-border);
            transform: scale(0.8) translateY(100%);
            opacity: 0;
            transform-origin: bottom right;
        }
        .chatbot-container.open {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
        .chatbot-header {
            background-color: var(--primary-color);
            color: var(--vlcp-white);
            padding: 1rem;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }
        .chatbot-header button {
            background: none;
            border: none;
            color: var(--vlcp-white);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
        }
        .chatbot-messages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        .chatbot-message {
            max-width: 80%;
            padding: 0.7rem 1rem;
            border-radius: 15px;
            line-height: 1.4;
            word-wrap: break-word;
        }
        .chatbot-message.user {
            background-color: var(--chatbot-message-user);
            color: var(--text-color);
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .chatbot-message.bot {
            background-color: var(--chatbot-message-bot);
            color: var(--chatbot-message-bot-text);
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }
        .chatbot-input-area {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--chatbot-border);
            gap: 0.5rem;
        }
        .chatbot-input-area input {
            flex-grow: 1;
            padding: 0.7rem 1rem;
            border-radius: 20px;
            border: 1px solid var(--chatbot-border);
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 1em;
        }
        .chatbot-input-area button {
            border-radius: 20px;
            padding: 0.7rem 1.2rem;
            font-size: 0.9em;
        }
        .chatbot-toggle-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: var(--vlcp-white);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 2em;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            z-index: 101;
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        .chatbot-toggle-button:hover {
            transform: scale(1.1);
            background-color: var(--secondary-color);
        }
        .chatbot-toggle-button.hide {
            opacity: 0;
            pointer-events: none;
        }

        /* Scroll-to-top button */
        .scroll-to-top {
            position: fixed;
            bottom: 90px;
            right: 20px;
            background-color: var(--secondary-color);
            color: var(--vlcp-white);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            z-index: 99;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.2s ease;
        }
        .scroll-to-top.show {
            opacity: 1;
            visibility: visible;
        }
        .scroll-to-top:hover {
            transform: translateY(-3px);
            background-color: var(--vlcp-blue-light);
        }


        /* Footer */
        .app-footer {
            text-align: center;
            padding: 1rem;
            margin-top: auto;
            background-color: var(--card-background);
            border-top: 1px solid var(--border-color);
            color: var(--secondary-color);
            font-size: 0.9rem;
            box-shadow: 0 -2px 10px var(--shadow-color);
            z-index: 10;
        }

        /* Toast Notifications */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast-message {
            background-color: var(--card-background);
            color: var(--text-color);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 250px;
            max-width: 350px;
            opacity: 0;
            transform: translateX(100%);
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        .toast-message.show {
            opacity: 1;
            transform: translateX(0);
        }
        .toast-message.hide {
            opacity: 0;
            transform: translateX(100%);
        }
        .toast-message.success {
            border-left: 5px solid var(--success-color);
        }
        .toast-message.error {
            border-left: 5px solid var(--danger-color);
        }
        .toast-message.info {
            border-left: 5px solid var(--primary-color);
        }
        .toast-message i {
            font-size: 1.2em;
        }
        .toast-message.success i { color: var(--success-color); }
        .toast-message.error i { color: var(--danger-color); }
        .toast-message.info i { color: var(--primary-color); }
        .toast-message span {
            flex-grow: 1;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .loading-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .loading-spinner {
            border: 6px solid var(--card-background);
            border-top: 6px solid var(--primary-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        /* Responsive Design */
        @media (max-width: 992px) {
            .main-nav {
                gap: 1rem;
            }
            .main-nav button {
                font-size: 0.9em;
                padding: 0.4rem 0.2rem;
            }
            .app-header .logo {
                height: 45px;
            }
            .page-section {
                padding: 2rem;
            }
        }

        @media (max-width: 768px) {
            body {
                font-size: 15px;
            }
            .app-header {
                flex-direction: row;
                justify-content: space-between;
                padding: 1rem;
            }
            .app-header .logo {
                height: 40px;
            }
            .main-nav {
                display: none;
            }
            .theme-toggle {
                display: none;
            }
            .hamburger-menu {
                display: block;
            }
            .main-content {
                padding: 1rem;
            }
            .hero-section {
                padding: 2rem 1rem;
            }
            .hero-section h2 {
                font-size: clamp(1.8rem, 6vw, 2.5rem);
            }
            .hero-section p {
                font-size: 1em;
            }
            .drop-zone {
                padding: 30px;
                font-size: 1.1rem;
            }
            .common-form {
                padding: 1.5rem;
                margin: 1.5rem auto;
            }
            .common-form .button-group {
                flex-direction: column;
            }
            .page-section {
                padding: 1.5rem;
            }
            .page-section ul li {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
                padding: 0.7rem 1rem;
            }
            .page-section ul li i {
                margin-bottom: 0.2rem;
            }
            .chatbot-container {
                width: 90%;
                height: 80%;
                top: 50%;
                left: 50%;
                transform: translate(-50%, 50%) scale(0.8);
                bottom: auto;
                right: auto;
            }
            .chatbot-container.open {
                transform: translate(-50%, -50%) scale(1);
            }
            .chatbot-toggle-button {
                bottom: 10px;
                right: 10px;
                width: 50px;
                height: 50px;
                font-size: 1.5em;
            }
            .scroll-to-top {
                bottom: 70px;
                right: 10px;
                width: 45px;
                height: 45px;
                font-size: 1.3em;
            }
            #toast-container {
                top: 10px;
                right: 10px;
                max-width: calc(100% - 20px);
            }
            .toast-message {
                min-width: unset;
                max-width: unset;
            }

            .active-chatroom {
                height: 70vh;
            }
            .chat-messages-display {
                font-size: 0.9em;
            }
            .chat-message {
                padding: 0.5rem 0.8rem;
            }
        }
    </style>

    <!-- 3. CDN Imports for React, ReactDOM, Babel, GSAP, Ethers.js, Gun.js -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollTrigger.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-6.7.1.umd.min.js"></script>
    <script src="https://unpkg.com/gun/gun.js"></script>
    <script src="https://unpkg.com/gun/sea.js"></script> <!-- SEA for user authentication/encryption -->

    <!-- Your brand song -->
    <audio id="brandSong" src="audio/SoundHelix-Song-1.mp3" autoplay loop></audio>

</head>
<body>
    <div id="root"></div>

    <!-- Scroll to Top Button -->
    <button id="scrollToTopBtn" class="scroll-to-top" title="Go to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- 4. ALL APPLICATION JAVASCRIPT -->
    <script type="text/babel">
        // Ensure ethers is globally available from the CDN
        const ethers = window.ethers;
        // Initialize Gun.js instance
        // IMPORTANT: Replace 'http://localhost:8765/gun' with your actual Gun.js server URL
        const gun = Gun('http://localhost:8765/gun');


        // GSAP Plugin Registration
        gsap.registerPlugin(ScrollTrigger);

        // Global Toast System
        const showToast = (message, type = 'info', duration = 3000) => {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) return;

            const toast = document.createElement('div');
            toast.className = `toast-message ${type}`;
            toast.innerHTML = `
                <i class="${type === 'success' ? 'fas fa-check-circle' : type === 'error' ? 'fas fa-times-circle' : 'fas fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            toastContainer.appendChild(toast);

            gsap.to(toast, { opacity: 1, x: 0, duration: 0.3, ease: 'power2.out', onComplete: () => {
                gsap.to(toast, { opacity: 0, x: '100%', delay: duration / 1000, duration: 0.3, ease: 'power2.in', onComplete: () => {
                    toast.remove();
                }});
            }});
        };

        // Global Loading Overlay
        const toggleLoading = (show) => {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                if (show) {
                    loadingOverlay.classList.add('show');
                } else {
                    loadingOverlay.classList.remove('show');
                }
            }
        };

        // 4.1. ThemeContext.js content
        const ThemeContext = React.createContext(undefined);

        const useTheme = () => {
            const context = React.useContext(ThemeContext);
            if (context === undefined) {
                throw new Error('useTheme must be used within a ThemeProvider');
            }
            return context;
        };

        const ThemeProvider = ({ children }) => {
            const [theme, setTheme] = React.useState(() => {
                if (typeof window !== 'undefined') {
                    return localStorage.getItem('ej-theme') || 'dark';
                }
                return 'dark';
            });

            React.useEffect(() => {
                document.body.className = theme === 'dark' ? 'dark-theme' : 'light-theme';
                localStorage.setItem('ej-theme', theme);
            }, [theme]);

            const toggleTheme = () => {
                setTheme((prevTheme) => (prevTheme === 'dark' ? 'light' : 'dark'));
            };

            const value = { theme, toggleTheme };
            return React.createElement(ThemeContext.Provider, { value }, children);
        };

        // 4.2. animations.js content (Adapted for responsive animations)
        const runDragAndDropAnimation = (dropZoneRef, e, primaryColor, accentGlow, cardBackground, borderColor) => {
            const tl = gsap.timeline();
            tl.fromTo(dropZoneRef.current, { backgroundColor: cardBackground }, { backgroundColor: accentGlow, duration: 0.5 });
            tl.fromTo(
                `.file-icon-simulated`, { opacity: 0, y: -50, scale: 0.5 },
                { opacity: 1, y: 0, scale: 1, duration: 0.6, ease: 'back.out(1.7)' }
            );
            tl.to(
                `.file-icon-simulated`, {
                    filter: `drop-shadow(0 0 10px ${primaryColor})`, scale: 1.05, rotationZ: 5,
                    repeat: 3, yoyo: true, duration: 0.2, ease: 'power1.inOut'
                }, '+=0.2'
            );
            tl.to(
                `.file-icon-simulated`, {
                    opacity: 0, scale: 0.2, duration: 0.5, ease: 'power2.in',
                    onComplete: () => {
                        const numChunks = window.innerWidth < 768 ? 2 : 5;
                        for (let i = 0; i < numChunks; i++) {
                            const chunk = document.createElement('div');
                            chunk.className = 'file-chunk-simulated';
                            gsap.set(chunk, {
                                x: 0, y: 0, opacity: 1, scale: 1, position: 'fixed', borderRadius: '50%',
                                backgroundColor: primaryColor, width: '10px', height: '10px', zIndex: 1000,
                                left: e.clientX, top: e.clientY,
                            });
                            document.body.appendChild(chunk);
                            gsap.to(chunk, {
                                x: 'random(-200, 200)', y: 'random(-200, 200)', opacity: 0, scale: 0,
                                duration: 1.5, ease: 'power3.out', onComplete: () => chunk.remove()
                            });
                        }
                    }
                }, '-=0.2'
            );
            tl.to({}, { duration: 0.1, onComplete: () => {
                showToast('File processing simulated!', 'info');
                console.log(`Simulated: File processing complete!`);
            }});
        };

        const animatePageSectionEntry = (selector, delay = 0) => {
            gsap.fromTo(selector,
                { opacity: 0, y: 50, scale: 0.9, rotationX: -10 },
                {
                    opacity: 1,
                    y: 0,
                    scale: 1,
                    rotationX: 0,
                    duration: window.innerWidth < 768 ? 0.8 : 1,
                    ease: 'power3.out',
                    delay: delay,
                    stagger: 0.2,
                    scrollTrigger: {
                        trigger: selector,
                        start: "top 80%",
                        toggleActions: "play none none none",
                    }
                }
            );
        };

        const animateListItemsEntry = (selector, delay = 0) => {
            gsap.fromTo(selector,
                { opacity: 0, x: -50 },
                {
                    opacity: 1,
                    x: 0,
                    duration: window.innerWidth < 768 ? 0.4 : 0.5,
                    stagger: 0.1,
                    ease: 'power2.out',
                    delay: delay,
                    scrollTrigger: {
                        trigger: selector,
                        start: "top 90%",
                        toggleActions: "play none none none",
                    }
                }
            );
        };

        const animateHeroSection = (heroSelector, h2Selector, pSelector, dropZoneSelector) => {
            const isMobile = window.innerWidth < 768;
            const tl = gsap.timeline({ defaults: { ease: 'power3.out', opacity: 0 } });

            tl.from(heroSelector, { scale: isMobile ? 0.9 : 0.8, duration: isMobile ? 0.8 : 1 })
              .from(h2Selector, { y: isMobile ? 20 : 30, duration: isMobile ? 0.6 : 0.8 }, "-=0.5")
              .from(pSelector, { y: isMobile ? 10 : 20, stagger: isMobile ? 0.1 : 0.2, duration: isMobile ? 0.5 : 0.7 }, "-=0.3")
              .from(dropZoneSelector, { y: isMobile ? 10 : 20, duration: isMobile ? 0.5 : 0.7, scale: isMobile ? 0.95 : 0.9 }, "-=0.3");
        };

        const applyInputFocusAnimation = (selector) => {
            gsap.utils.toArray(selector).forEach(input => {
                const initialBorderColor = getComputedStyle(input).borderColor;
                const initialBoxShadow = getComputedStyle(input).boxShadow;

                input.addEventListener('focus', () => {
                    gsap.to(input, {
                        borderColor: 'var(--primary-color)',
                        boxShadow: '0 0 0 3px var(--accent-glow)',
                        duration: 0.2
                    });
                });
                input.addEventListener('blur', () => {
                    gsap.to(input, {
                        borderColor: initialBorderColor,
                        boxShadow: initialBoxShadow,
                        duration: 0.2
                    });
                });
            });
        };

        // 4.3. web3Utils.js content
        // IMPORTANT: Replace these with your deployed contract addresses
        const CERT_VERIFIER_CONTRACT_ADDRESS = '0xE7C1F17Cc6aC5CEB7f763DcE84310D2c26bDF927';
        const VLCP_TOKEN_CONTRACT_ADDRESS = 'YOUR_VLCP_TOKEN_CONTRACT_ADDRESS'; // <<< REPLACE THIS
        const CHATROOM_MANAGER_CONTRACT_ADDRESS = 'YOUR_CHATROOM_MANAGER_CONTRACT_ADDRESS'; // <<< REPLACE THIS

        // IMPORTANT: Replace these with the FULL ABIs from your compiled contracts
        const CERT_VERIFIER_CONTRACT_ABI = [
            "event CertificateIssued(string indexed certificateHash, uint256 indexed studentId, address indexed issuer, uint256 issueTimestamp, string ipfsHash)",
            "function issueCertificate(uint256 _studentId, string calldata _ipfsHash, string calldata _certificateHash) external",
            "function verifyCertificate(string calldata _certificateHash) external view returns (bool, uint256, string memory, address, uint256)",
            "function owner() public view returns (address)",
        ];

        const VLCP_TOKEN_ABI = [
            // Minimal ABI for ERC-20 functions used
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function decimals() view returns (uint8)",
            "function totalSupply() view returns (uint255)",
            "function balanceOf(address account) view returns (uint255)",
            "function transfer(address to, uint256 amount) returns (bool)",
            "function approve(address spender, uint256 amount) returns (bool)",
            "function allowance(address owner, address spender) view returns (uint256)",
            "function mint(address to, uint256 amount)",
        ];

        const CHATROOM_MANAGER_ABI = [
            "event ChatroomCreated(string indexed chatroomName, address indexed creator, uint256 feePaid)",
            "event ModeratorAdded(string indexed chatroomName, address indexed moderator, address indexed addedBy)",
            "function chatroomCreationFee() view returns (uint256)",
            "function createChatroom(string calldata _chatroomName)",
            "function addModerator(string calldata _chatroomName, address _moderatorAddress)",
            "function isModerator(string calldata _chatroomName, address _addr) view returns (bool)",
            "function getChatroomOwner(string calldata _chatroomName) view returns (address)",
            "function chatrooms(string) view returns (address owner, bool exists)",
            "function setChatroomFee(uint256 _newFee)",
            "function owner() view returns (address)",
        ];


        const connectWallet = async () => {
            if (window.ethereum) {
                try {
                    toggleLoading(true);
                    showToast('Connecting wallet...', 'info');
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const provider = new ethers.BrowserProvider(window.ethereum);
                    const signer = await provider.getSigner();
                    const address = await signer.getAddress();
                    const network = await provider.getNetwork();
                    toggleLoading(false);
                    showToast('Wallet connected successfully!', 'success');
                    return { provider, signer, address, chainId: network.chainId };
                } catch (error) {
                    toggleLoading(false);
                    console.error("Error connecting wallet:", error);
                    showToast(`Failed to connect wallet: ${error.message}`, 'error');
                    throw new Error("Failed to connect wallet. Please ensure MetaMask is installed and unlocked.");
                }
            } else {
                showToast("MetaMask is not installed. Please install it to use this feature.", 'error');
                throw new Error("MetaMask is not installed. Please install it to use this feature.");
            }
        };

        const getCertificateVerifierContract = (signerOrProvider) => {
            return new ethers.Contract(
                CERT_VERIFIER_CONTRACT_ADDRESS,
                CERT_VERIFIER_CONTRACT_ABI,
                signerOrProvider
            );
        };

        const getVLCPTokenContract = (signerOrProvider) => {
            return new ethers.Contract(
                VLCP_TOKEN_CONTRACT_ADDRESS,
                VLCP_TOKEN_ABI,
                signerOrProvider
            );
        };

        const getChatroomManagerContract = (signerOrProvider) => {
            return new ethers.Contract(
                CHATROOM_MANAGER_CONTRACT_ADDRESS,
                CHATROOM_MANAGER_ABI,
                signerOrProvider
            );
        };

        const generateCertificateHash = (studentId, courseName, issueDate) => {
            const rawString = `${studentId}-${courseName}-${issueDate}-${Math.random().toString(36).substring(2, 15)}`;
            return ethers.utils.keccak256(ethers.utils.toUtf8Bytes(rawString));
        };

        const fetchIpfsMetadata = async (ipfsHash) => {
            try {
                const response = await fetch(`https://ipfs.io/ipfs/${ipfsHash}`);
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error(`IPFS metadata not found for hash: ${ipfsHash}. It might not be pinned or is incorrect.`);
                    }
                    throw new Error(`HTTP error! status: ${response.status} - ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error("Error fetching IPFS metadata:", error);
                if (error.message.includes('Failed to fetch')) {
                    throw new Error("Could not connect to IPFS gateway. Please check your internet connection.");
                }
                throw new Error(`Failed to retrieve certificate metadata from IPFS: ${error.message}`);
            }
        };

        // 4.4. Chatbot.js component
        const Chatbot = ({ isOpen, setIsOpen }) => {
            const [messages, setMessages] = React.useState([]);
            const [input, setInput] = React.useState('');
            const messagesEndRef = React.useRef(null);
            const chatbotRef = React.useRef(null);

            const [bookingStep, setBookingStep] = React.useState('initial');
            const [bookingData, setBookingData] = React.useState({});

            const addMessage = (text, sender = 'bot') => {
                setMessages((prevMessages) => [...prevMessages, { text, sender, id: Date.now() + Math.random() }]);
            };

            React.useEffect(() => {
                if (messagesEndRef.current) {
                    messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
                }
                if (messages.length > 0) {
                    const lastMessageElement = document.querySelector(`.chatbot-message:last-child`);
                    if (lastMessageElement) {
                        gsap.from(lastMessageElement, { opacity: 0, y: 10, duration: 0.3, ease: 'power2.out' });
                    }
                }
            }, [messages]);

            React.useEffect(() => {
                if (isOpen) {
                    gsap.to(chatbotRef.current, { scale: 1, y: 0, opacity: 1, duration: 0.5, ease: 'back.out(1.7)' });
                } else {
                    gsap.to(chatbotRef.current, { scale: 0.8, y: '100%', opacity: 0, duration: 0.5, ease: 'power2.in' });
                }
            }, [isOpen]);

            React.useEffect(() => {
                if (messages.length === 0 && isOpen) {
                    addMessage("Hello! I'm your VLCP AI Assistant. How can I assist you today?");
                } else if (isOpen && bookingStep === 'initial') {
                    const lastUserMessage = messages.length > 0 && messages[messages.length - 1].sender === 'user' ? messages[messages.length - 1].text.toLowerCase() : '';
                    if (lastUserMessage.includes('register') || lastUserMessage.includes('webinar') || lastUserMessage.includes('event')) {
                        setBookingStep('askName');
                        addMessage("Excellent! Let's get you registered for a webinar or event. First, what's your full name?");
                    }
                }
            }, [isOpen, messages, bookingStep]);

            const handleSendMessage = async () => {
                if (input.trim() === '') return;

                addMessage(input, 'user');
                const userMessage = input.trim().toLowerCase();
                setInput('');

                let botResponse = '';

                if (bookingStep === 'initial') {
                    if (userMessage.includes('hello') || userMessage.includes('hi')) {
                        botResponse = "Welcome to VLCP! How can I help you learn and connect today? Ask me about our courses, community, or how to register for an event.";
                    } else if (userMessage.includes('courses') || userMessage.includes('learn') || userMessage.includes('resources')) {
                        botResponse = "VLCP offers a wide range of high-quality educational courses designed for learners of all levels. Check out our 'Courses & Resources' page!";
                    } else if (userMessage.includes('community') || userMessage.includes('forum')) {
                        botResponse = "Our platform fosters a strong, supportive community through discussion forums and interactive sessions. It's a great place to connect with fellow learners!";
                    } else if (userMessage.includes('shariah') || userMessage.includes('islamic values') || userMessage.includes('halal')) {
                        botResponse = "All our content is guided by a dedicated Shariah advisory board, ensuring continuous compliance with Islamic principles and fostering an ethical learning environment.";
                    } else if (userMessage.includes('partner') || userMessage.includes('institution')) {
                        botResponse = "We partner with recognized Islamic educational institutions to enhance the credibility and variety of our courses. We're always expanding our network!";
                    } else if (userMessage.includes('register') || userMessage.includes('webinar') || userMessage.includes('event') || userMessage.includes('sign up')) {
                        setBookingStep('askName');
                        botResponse = "Great! Let's get you registered for a webinar or event. What's your full name?";
                    } else if (userMessage.includes('chat') || userMessage.includes('chatroom') || userMessage.includes('discussion')) {
                        botResponse = "Explore our decentralized chatrooms! You can create your own for 500 VLCP tokens or join existing ones. Check the 'Chatrooms' page!";
                    } else {
                        botResponse = "I'm here to help you navigate VLCP! Ask me about our courses, community, or how to register for an event.";
                    }
                } else if (bookingStep === 'askName') {
                    setBookingData(prev => ({ ...prev, name: input.trim() }));
                    setBookingStep('askEmail');
                    botResponse = `Thank you, ${input.trim()}! What's your email address for the registration?`;
                } else if (bookingStep === 'askEmail') {
                    if (!/\S+@\S+\.\S+/.test(input.trim())) {
                        botResponse = "That doesn't look like a valid email. Please enter a correct email address.";
                    } else {
                        setBookingData(prev => ({ ...prev, email: input.trim() }));
                        setBookingStep('askEvent');
                        botResponse = "Got it. Which webinar or event are you interested in registering for?";
                    }
                } else if (bookingStep === 'askEvent') {
                    setBookingData(prev => ({ ...prev, event: input.trim() }));
                    setBookingStep('confirm');
                    botResponse = `Alright, ${bookingData.name}! Here are your registration details:\n\n` +
                                          `Email: ${bookingData.email}\n` +
                                          `Event: ${input.trim()}\n\n` +
                                          `Does everything look correct? (Yes/No)`;
                } else if (bookingStep === 'confirm') {
                    if (userMessage === 'yes') {
                        console.log("Simulating webinar registration:", bookingData);
                        botResponse = "Your registration is confirmed! We've sent a confirmation to your email. We look forward to seeing you there!";
                        setBookingStep('booked');
                    } else {
                        botResponse = "No worries! Let's restart the registration process. What's your full name again?";
                        setBookingStep('askName');
                        setBookingData({});
                    }
                } else if (bookingStep === 'booked') {
                    botResponse = "Your registration is already confirmed! Is there anything else I can help you with regarding VLCP?";
                }

                if (botResponse) {
                    addMessage(botResponse);
                }
            };

            return React.createElement('div', { className: `chatbot-container ${isOpen ? 'open' : ''}`, ref: chatbotRef },
                React.createElement('div', { className: 'chatbot-header' },
                    'VLCP AI Assistant',
                    React.createElement('button', { onClick: () => setIsOpen(false) }, '✕')
                ),
                React.createElement('div', { className: 'chatbot-messages' },
                    messages.map((msg) =>
                        React.createElement('div', { key: msg.id, className: `chatbot-message ${msg.sender}` }, msg.text)
                    ),
                    React.createElement('div', { ref: messagesEndRef })
                ),
                React.createElement('div', { className: 'chatbot-input-area' },
                    React.createElement('input', {
                        type: 'text',
                        placeholder: 'Type your message...',
                        value: input,
                        onChange: (e) => setInput(e.target.value),
                        onKeyPress: (e) => { if (e.key === 'Enter') handleSendMessage(); }
                    }),
                    React.createElement('button', { onClick: handleSendMessage }, 'Send')
                )
            );
        };

        // 4.5. Page Components
        const HomePage = ({ currentPage }) => {
            const dropZoneRef = React.useRef(null);
            const [isDragging, setIsDragging] = React.useState(false);
            const { theme } = useTheme();

            const handleDragEnter = React.useCallback((e) => {
                e.preventDefault(); e.stopPropagation();
                setIsDragging(true);
                gsap.to(dropZoneRef.current, { scale: 1.05, borderWidth: 4, borderColor: 'var(--primary-color)', duration: 0.3, ease: 'power2.out' });
            }, []);

            const handleDragLeave = React.useCallback((e) => {
                e.preventDefault(); e.stopPropagation();
                setIsDragging(false);
                gsap.to(dropZoneRef.current, { scale: 1, borderWidth: 2, borderColor: 'var(--border-color)', duration: 0.3, ease: 'power2.out' });
            }, []);

            const handleDragOver = React.useCallback((e) => { e.preventDefault(); e.stopPropagation(); }, []);

            const handleDrop = React.useCallback((e) => {
                e.preventDefault(); e.stopPropagation();
                setIsDragging(false);
                gsap.to(dropZoneRef.current, { scale: 1, borderWidth: 2, borderColor: 'var(--border-color)', duration: 0.3, ease: 'power2.out' });

                const droppedFiles = Array.from(e.dataTransfer.files);
                if (droppedFiles.length > 0) {
                    const style = getComputedStyle(document.body);
                    const primaryColor = style.getPropertyValue('--primary-color').trim();
                    const accentGlow = style.getPropertyValue('--accent-glow').trim();
                    const cardBackground = style.getPropertyValue('--card-background').trim();
                    const borderColor = style.getPropertyValue('--border-color').trim();

                    droppedFiles.forEach((file) => {
                        runDragAndDropAnimation(dropZoneRef, e, primaryColor, accentGlow, cardBackground, borderColor);
                    });
                }
            }, []);

            React.useEffect(() => {
                if (currentPage === 'home') {
                    animateHeroSection('.hero-section', '.hero-section h2', '.hero-section p', '.drop-zone');
                }
            }, [currentPage]);

            return React.createElement('div', { className: 'home-page-container' },
                React.createElement('section', { className: 'hero-section card-3d' },
                    React.createElement('h2', null, 'Your Gateway to Knowledge & Community!'),
                    React.createElement('p', null, 'Welcome to the Virtual Learning & Community Platform (VLCP). We are dedicated to providing ',
                        React.createElement('strong', null, 'high-quality educational resources'), ' and fostering a ',
                        React.createElement('strong', null, 'strong, supportive community'), '. Our diverse courses, interactive webinars, and engaging forums cater to learners of all levels, all while upholding ',
                        React.createElement('strong', null, 'Islamic values'), '.'
                    ),
                    React.createElement('p', null,
                        React.createElement('strong', null, React.createElement('i', { className: 'fas fa-book-open' }), ' Diverse Courses:'), ' Explore foundational Islamic sciences, personal development, and contemporary issues.'),
                    React.createElement('p', null,
                        React.createElement('strong', null, React.createElement('i', { className: 'fas fa-users' }), ' Global Community:'), ' Connect and grow with fellow learners worldwide.'),
                    React.createElement('p', null,
                        React.createElement('strong', null, React.createElement('i', { className: 'fas fa-certificate' }), ' Secure Certificates:'), ' Verify your achievements on the blockchain with our integrated DApp.'),
                    React.createElement('p', null, 'Start your learning journey or chat with our AI assistant for guidance!'),
                    React.createElement('div', {
                        ref: dropZoneRef,
                        className: `drop-zone ${isDragging ? 'dragging' : ''}`,
                        onDragEnter: handleDragEnter,
                        onDragLeave: handleDragLeave,
                        onDragOver: handleDragOver,
                        onDrop: handleDrop
                    },
                    isDragging ? 'Release files here for review!' : 'Drag & Drop Your Learning Materials (Simulated)',
                    React.createElement('div', { className: 'file-icon-simulated' }, '🎓')
                    )
                )
            );
        };

        const CoursesPage = ({ currentPage }) => {
            React.useEffect(() => {
                if (currentPage === 'courses') {
                    animatePageSectionEntry('.courses-section');
                    animateListItemsEntry('.courses-list li', 0.5);
                }
            }, [currentPage]);
            return React.createElement('section', { className: 'page-section card-3d courses-section' },
                React.createElement('h2', null, 'Our Comprehensive Courses & Resources'),
                React.createElement('p', null, 'VLCP offers a diverse range of high-quality educational content designed to enrich your knowledge and skills, all grounded in authentic Islamic teachings and contemporary relevance.'),
                React.createElement('ul', { className: 'courses-list' },
                    React.createElement('li', null, React.createElement('i', { className: 'fas fa-quran' }), React.createElement('strong', null, 'Foundational Islamic Studies'), ' – In-depth modules on Quranic sciences, Hadith, Fiqh, and Aqeedah (Islamic Creed).'),
                    React.createElement('li', null, React.createElement('i', { className: 'fas fa-user-tie' }), React.createElement('strong', null, 'Personal & Professional Development'), ' – Courses integrating Islamic ethics with modern skills for holistic growth.'),
                    React.createElement('li', null, React.createElement('i', { className: 'fas fa-language' }), React.createElement('strong', null, 'Arabic Language & Quranic Recitation'), ' – Interactive lessons for all levels, from beginners to advanced Tajweed.'),
                    React.createElement('li', null, React.createElement('i', { className: 'fas fa-lightbulb' }), React.createElement('strong', null, 'Contemporary Issues & Fiqh'), ' – Exploring modern challenges and their rulings through the lens of Shariah principles.'),
                    React.createElement('li', null, React.createElement('i', { className: 'fas fa-home' }), React.createElement('strong', null, 'Family & Community Building'), ' – Resources for fostering strong, compassionate family ties and vibrant Muslim communities.'),
                    React.createElement('li', null, React.createElement('i', { className: 'fas fa-robot' }), React.createElement('strong', null, 'Tech & Innovation (Islamic Perspective)'), ' – Exploring the intersection of technology and Islamic values, including blockchain applications.')
                ),
                React.createElement('p', null, 'Our curriculum is continuously reviewed and guided by our dedicated ', React.createElement('strong', null, 'Shariah Advisory Board'), ' to ensure authenticity, ethical compliance, and relevance for today\'s learner.')
            );
        };

        const WebinarsPage = ({ currentPage }) => {
            React.useEffect(() => {
                if (currentPage === 'webinars') {
                    animatePageSectionEntry('.webinar-section');
                }
            }, [currentPage]);
            return React.createElement('section', { className: 'page-section card-3d webinar-section' },
                React.createElement('h2', null, 'Join Our Engaging Webinars & Special Events'),
                React.createElement('div', { className: 'webinar-info' },
                    React.createElement('p', null, 'Engage with leading scholars, experts, and community leaders in live, interactive sessions. Our webinars cover a diverse range of topics from foundational Islamic sciences to contemporary issues facing the global Muslim community.'),
                    React.createElement('ul', null,
                        React.createElement('li', null, React.createElement('i', { className: 'fas fa-comments' }), React.createElement('strong', null, 'Live Q&A:'), ' Direct interaction with speakers.'),
                        React.createElement('li', null, React.createElement('i', { className: 'fas fa-calendar-alt' }), React.createElement('strong', null, 'Flexible Access:'), ' Access recordings for a limited time after the live event.'),
                        React.createElement('li', null, React.createElement('i', { className: 'fas fa-lock' }), React.createElement('strong', null, 'Seamless Registration:'), ' Secure and easy sign-up process.'),
                        React.createElement('li', null, React.createElement('i', { className: 'fas fa-brain' }), React.createElement('strong', null, 'Curated Content:'), ' Topics aligned with Shariah principles and relevant community needs.')
                    ),
                    React.createElement('p', null, 'To register for an upcoming webinar or event, simply say "', React.createElement('strong', null, 'I want to register for a webinar'), '" to our AI Assistant, and it will guide you through the process!'),
                    React.createElement('p', null, 'Stay informed about our upcoming schedule by subscribing to our newsletter and checking this page regularly. We look forward to seeing you there, insha\'Allah.')
                )
            );
        };

        const AboutUsPage = ({ currentPage }) => {
            React.useEffect(() => {
                if (currentPage === 'about-us') {
                    animatePageSectionEntry('.about-section');
                    animateListItemsEntry('.about-content p, .about-content li', 0.5);
                }
            }, [currentPage]);
            return React.createElement('section', { className: 'page-section card-3d about-section' },
                React.createElement('h2', null, 'About VLCP: Virtual Learning & Community Platform'),
                React.createElement('div', { className: 'about-content' },
                    React.createElement('p', null, 'VLCP is more than just an online platform; it’s a global initiative dedicated to empowering individuals through accessible, high-quality, and ethically guided education. We believe in harnessing the power of technology to disseminate beneficial knowledge and foster a thriving, supportive community.'),
                    React.createElement('p', null, 'Our mission is rooted in the timeless principles of Islamic values, ensuring a learning environment that is not only intellectually stimulating but also spiritually enriching and safe for everyone.'),
                    React.createElement('ul', null,
                        React.createElement('li', null, React.createElement('i', { className: 'fas fa-handshake' }), React.createElement('strong', null, 'Strategic Partnerships:'), ' We forge alliances with recognized Islamic educational institutions and experts globally to enhance the credibility and diversity of our course offerings.'),
                        React.createElement('li', null, React.createElement('i', { className: 'fas fa-gavel' }), React.createElement('strong', null, 'Shariah Advisory & Compliance:'), ' A dedicated Shariah advisory board continuously monitors and guides all aspects of the platform – from content development to community interactions – ensuring unwavering adherence to Islamic principles.'),
                        React.createElement('li', null, React.createElement('i', { className: 'fas fa-users-line' }), React.createElement('strong', null, 'Community-Centric Approach:'), ' We prioritize building a vibrant and inclusive community where learners can connect, collaborate, and support each other\'s educational journeys.'),
                        React.createElement('li', null, React.createElement('i', { className: 'fas fa-code-branch' }), React.createElement('strong', null, 'Innovation & Accessibility:'), ' We integrate cutting-edge technology, including blockchain for secure certificate verification, to make learning engaging, transparent, and accessible to a global audience.'),
                        React.createElement('li', null, React.createElement('i', { className: 'fas fa-seedling' }), React.createElement('strong', null, 'Holistic Growth:'), ' Our programs are designed to facilitate not just academic achievement, but also personal, spiritual, and ethical development.')
                    ),
                    React.createElement('p', null, 'Join the VLCP family and embark on a journey of knowledge, connection, and purpose. Together, we can build a brighter future, insha\'Allah.')
                )
            );
        };

        const CertificateIssuer = ({ currentPage }) => {
            const [walletAddress, setWalletAddress] = React.useState(null);
            const [contractOwner, setContractOwner] = React.useState(null);
            const [status, setStatus] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);
            const [formData, setFormData] = React.useState({
                studentId: '',
                studentName: '',
                courseName: '',
                issueDate: new Date().toISOString().split('T')[0],
                grade: '',
                ipfsHashPlaceholder: '',
                certificateHash: ''
            });

            React.useEffect(() => {
                if (currentPage === 'certificate-issuer') {
                    animatePageSectionEntry('.issuer-container');
                    applyInputFocusAnimation('.common-form input');
                }
            }, [currentPage]);

            const handleConnectWallet = async () => {
                try {
                    setIsLoading(true);
                    toggleLoading(true);
                    setStatus('Connecting wallet...');
                    const { address, signer } = await connectWallet();
                    setWalletAddress(address);

                    const contract = getCertificateVerifierContract(signer);
                    const owner = await contract.owner();
                    setContractOwner(owner);

                    if (address.toLowerCase() !== owner.toLowerCase()) {
                        setStatus('Wallet connected, but you are not the contract owner. You cannot issue certificates.');
                        showToast('Not authorized to issue certificates.', 'error');
                    } else {
                        setStatus('Wallet connected. You are the contract owner.');
                        showToast('Wallet connected. Ready to issue certificates.', 'success');
                    }
                } catch (error) {
                    setStatus(`Error: ${error.message}`);
                    setWalletAddress(null);
                    setContractOwner(null);
                } finally {
                    setIsLoading(false);
                    toggleLoading(false);
                }
            };

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleIssueCertificate = async (e) => {
                e.preventDefault();
                if (!walletAddress) {
                    showToast('Please connect your wallet first.', 'error');
                    return;
                }
                if (walletAddress.toLowerCase() !== contractOwner.toLowerCase()) {
                    showToast('Only the contract owner can issue certificates.', 'error');
                    return;
                }
                if (!formData.studentId || !formData.studentName || !formData.courseName || !formData.issueDate || !formData.grade) {
                    showToast('Please fill in all certificate details.', 'error');
                    return;
                }

                setIsLoading(true);
                toggleLoading(true);
                setStatus('Preparing certificate metadata for IPFS...');
                showToast('Preparing certificate metadata...', 'info');

                try {
                    const ipfsMetadata = {
                        studentId: formData.studentId,
                        studentName: formData.studentName,
                        courseName: formData.courseName,
                        issueDate: formData.issueDate,
                        grade: formData.grade,
                        platform: "VLCP - Virtual Learning & Community Platform",
                    };
                    const ipfsHash = `Qm${generateCertificateHash(formData.studentId, formData.courseName, formData.issueDate).substring(2)}`;
                    setFormData(prev => ({ ...prev, ipfsHashPlaceholder: ipfsHash }));

                    const certHash = generateCertificateHash(formData.studentId, formData.courseName, formData.issueDate);
                    setFormData(prev => ({ ...prev, certificateHash: certHash }));

                    setStatus(`IPFS metadata prepared. Issuing certificate on-chain with hash: ${certHash}...`);
                    showToast('Issuing certificate on blockchain. Confirm in MetaMask...', 'info', 5000);

                    const { signer } = await connectWallet();
                    const contract = getCertificateVerifierContract(signer);

                    const tx = await contract.issueCertificate(
                        formData.studentId,
                        ipfsHash,
                        certHash
                    );
                    setStatus('Transaction sent, waiting for confirmation...');
                    showToast('Transaction sent. Waiting for blockchain confirmation...', 'info', 5000);
                    await tx.wait();

                    setStatus(`Certificate issued successfully! Tx Hash: ${tx.hash}. Certificate Hash: ${certHash}`);
                    showToast(`Certificate issued! Hash: ${certHash.substring(0, 8)}...`, 'success', 7000);

                    setFormData({ studentId: '', studentName: '', courseName: '', issueDate: new Date().toISOString().split('T')[0], grade: '', ipfsHashPlaceholder: '', certificateHash: '' });
                } catch (error) {
                    console.error("Error issuing certificate:", error);
                    setStatus(`Error issuing certificate: ${error.message}`);
                    showToast(`Error issuing certificate: ${error.message}`, 'error', 10000);
                } finally {
                    setIsLoading(false);
                    toggleLoading(false);
                }
            };

            return React.createElement('section', { className: 'page-section card-3d issuer-container' },
                React.createElement('h2', null, 'Issue New Course Certificate (Admin Panel)'),
                React.createElement('p', null, 'This panel allows authorized VLCP personnel to issue new student course certificates on the blockchain, linking them to verifiable IPFS metadata.'),

                React.createElement('div', { className: 'form-group' },
                    React.createElement('button', { onClick: handleConnectWallet, disabled: isLoading || walletAddress },
                        isLoading ? 'Connecting...' : (walletAddress ? `Wallet Connected: ${walletAddress.substring(0, 6)}...${walletAddress.slice(-4)}` : 'Connect Wallet (MetaMask)')
                    ),
                    walletAddress && contractOwner && React.createElement('p', null, `Contract Owner: ${contractOwner.substring(0, 6)}...${contractOwner.slice(-4)}`),
                    walletAddress && contractOwner && walletAddress.toLowerCase() !== contractOwner.toLowerCase() &&
                        React.createElement('p', { style: { color: 'red', fontSize: '0.9em' } }, React.createElement('i', { className: 'fas fa-exclamation-triangle' }), ' You are not the contract owner. Issuance is restricted.')
                ),

                walletAddress && contractOwner && walletAddress.toLowerCase() === contractOwner.toLowerCase() && (
                    React.createElement('form', { onSubmit: handleIssueCertificate, className: 'common-form' },
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', { htmlFor: 'studentId' }, 'Student ID (from VLCP DB):'),
                            React.createElement('input', {
                                type: 'number',
                                id: 'studentId',
                                name: 'studentId',
                                value: formData.studentId,
                                onChange: handleChange,
                                required: true,
                                disabled: isLoading
                            })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', { htmlFor: 'studentName' }, 'Student Full Name:'),
                            React.createElement('input', {
                                type: 'text',
                                id: 'studentName',
                                name: 'studentName',
                                value: formData.studentName,
                                onChange: handleChange,
                                required: true,
                                disabled: isLoading
                            })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', { htmlFor: 'courseName' }, 'Course Name:'),
                            React.createElement('input', {
                                type: 'text',
                                id: 'courseName',
                                name: 'courseName',
                                value: formData.courseName,
                                onChange: handleChange,
                                required: true,
                                disabled: isLoading
                            })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', { htmlFor: 'grade' }, 'Grade/Achievement:'),
                            React.createElement('input', {
                                type: 'text',
                                id: 'grade',
                                name: 'grade',
                                value: formData.grade,
                                onChange: handleChange,
                                required: true,
                                disabled: isLoading
                            })
                        ),
                        React.createElement('div', { className: 'form-group' },
                            React.createElement('label', { htmlFor: 'issueDate' }, 'Issue Date:'),
                            React.createElement('input', {
                                type: 'date',
                                id: 'issueDate',
                                name: 'issueDate',
                                value: formData.issueDate,
                                onChange: handleChange,
                                required: true,
                                disabled: isLoading
                            })
                        ),
                        React.createElement('button', { type: 'submit', disabled: isLoading },
                            isLoading ? 'Issuing Certificate...' : 'Issue Certificate'
                        )
                    )
                ),
                status && React.createElement('p', { style: { marginTop: '1rem', color: status.includes('Error') ? 'red' : 'green', fontSize: '0.9em' } }, status)
            );
        };

        const CertificateVerifierPage = ({ currentPage }) => {
            const [certificateHash, setCertificateHash] = React.useState('');
            const [verificationResult, setVerificationResult] = React.useState(null);
            const [status, setStatus] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);

            React.useEffect(() => {
                if (currentPage === 'certificate-verifier') {
                    animatePageSectionEntry('.verifier-container');
                    applyInputFocusAnimation('.common-form input');
                }
            }, [currentPage]);

            const handleVerify = async (e) => {
                e.preventDefault();
                if (!certificateHash) {
                    showToast('Please enter a certificate hash.', 'error');
                    return;
                }

                setIsLoading(true);
                toggleLoading(true);
                setStatus('Verifying certificate on blockchain...');
                showToast('Verifying certificate on blockchain...', 'info');
                setVerificationResult(null);

                try {
                    const provider = window.ethereum ? new ethers.BrowserProvider(window.ethereum) : new ethers.JsonRpcProvider('https://sepolia.infura.io/v3/YOUR_INFURA_PROJECT_ID');
                    if (!window.ethereum) {
                        console.warn("MetaMask not detected. Using a public RPC provider. Ensure it's the correct network.");
                        showToast("MetaMask not detected. Using a public RPC provider.", 'info');
                    }

                    const contract = getCertificateVerifierContract(provider);

                    const [exists, studentId, ipfsHash, issuer, issueTimestamp] = await contract.verifyCertificate(certificateHash);

                    if (exists) {
                        setStatus('Certificate found on blockchain. Attempting to fetch metadata from IPFS...');
                        showToast('Certificate found. Fetching IPFS metadata...', 'info');
                        let ipfsMetadata = null;
                        try {
                            ipfsMetadata = await fetchIpfsMetadata(ipfsHash);
                        } catch (ipfsError) {
                            console.error("Failed to fetch IPFS metadata:", ipfsError);
                            setStatus(`Certificate found on blockchain, but failed to fetch IPFS metadata: ${ipfsError.message}`);
                            showToast(`Failed to fetch IPFS metadata: ${ipfsError.message.substring(0, 50)}...`, 'error', 7000);
                        }

                        setVerificationResult({
                            exists: true,
                            studentId: studentId.toString(),
                            ipfsHash,
                            issuer,
                            issueTimestamp: new Date(Number(issueTimestamp) * 1000).toLocaleString(),
                            metadata: ipfsMetadata
                        });
                        if (ipfsMetadata) {
                            setStatus('Certificate verified successfully, including IPFS metadata!');
                            showToast('Certificate verified successfully!', 'success', 5000);
                        } else {
                            setStatus('Certificate verified on blockchain, but IPFS metadata could not be retrieved.');
                        }

                    } else {
                        setVerificationResult({ exists: false });
                        setStatus('Certificate not found on blockchain. Please double-check the hash.');
                        showToast('Certificate not found. Check the hash.', 'error', 5000);
                    }
                } catch (error) {
                    console.error("Error verifying certificate:", error);
                    setStatus(`Error verifying certificate: ${error.message}`);
                    showToast(`Error verifying certificate: ${error.message.substring(0, 50)}...`, 'error', 10000);
                    setVerificationResult(null);
                } finally {
                    setIsLoading(false);
                    toggleLoading(false);
                }
            };

            return React.createElement('section', { className: 'page-section card-3d verifier-container' },
                React.createElement('h2', null, 'Verify VLCP Course Certificate'),
                React.createElement('p', null, 'Enter a unique certificate hash to verify its authenticity and detailed information on the blockchain. This ensures transparency and immutability of student achievements.'),

                React.createElement('form', { onSubmit: handleVerify, className: 'common-form' },
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'certHash' }, 'Certificate Hash:'),
                        React.createElement('input', {
                            type: 'text',
                            id: 'certHash',
                            name: 'certHash',
                            value: certificateHash,
                            onChange: (e) => setCertificateHash(e.target.value),
                            placeholder: 'e.g., 0xabcdef123456...',
                            required: true,
                            disabled: isLoading
                        })
                    ),
                    React.createElement('button', { type: 'submit', disabled: isLoading },
                        isLoading ? 'Verifying...' : 'Verify Certificate'
                    )
                )
            );
        };

        // NEW: Chatrooms Page Component
        const ChatroomsPage = ({ currentPage }) => {
            const [walletAddress, setWalletAddress] = React.useState(null);
            const [vlcpBalance, setVlcpBalance] = React.useState('0');
            const [chatroomCreationFee, setChatroomCreationFee] = React.useState('0');
            const [currentAllowance, setCurrentAllowance] = React.useState('0');
            const [chatroomName, setChatroomName] = React.useState('');
            const [chatrooms, setChatrooms] = React.useState([]);
            const [activeChatroom, setActiveChatroom] = React.useState(null);
            const [chatMessages, setChatMessages] = React.useState([]);
            const [chatInput, setChatInput] = React.useState('');
            const messagesEndRef = React.useRef(null);
            const [moderatorAddress, setModeratorAddress] = React.useState('');
            const [isOwnerOfActiveChatroom, setIsOwnerOfActiveChatroom] = React.useState(false);
            const [isModeratorOfActiveChatroom, setIsModeratorOfActiveChatroom] = React.useState(false);
            const [userPair, setUserPair] = React.useState(null); // Gun.js SEA key pair
            const [userAlias, setUserAlias] = React.useState(''); // User's display name
            const [tempAlias, setTempAlias] = React.useState(''); // For alias input field
            const [loginPassword, setLoginPassword] = React.useState(''); // For Gun.js login

            const providerRef = React.useRef(null); // To store ethers provider for listeners

            // --- Wallet Data Fetching & Listeners ---
            const fetchWalletData = React.useCallback(async (addr) => {
                if (!addr) return;
                try {
                    const provider = new ethers.BrowserProvider(window.ethereum);
                    const tokenContract = getVLCPTokenContract(provider);
                    const managerContract = getChatroomManagerContract(provider);

                    const balance = await tokenContract.balanceOf(addr);
                    setVlcpBalance(ethers.utils.formatUnits(balance, 18));

                    const fee = await managerContract.chatroomCreationFee();
                    setChatroomCreationFee(ethers.utils.formatUnits(fee, 18));

                    const allowance = await tokenContract.allowance(addr, CHATROOM_MANAGER_CONTRACT_ADDRESS);
                    setCurrentAllowance(ethers.utils.formatUnits(allowance, 18));

                    if (activeChatroom) {
                        const chatroomOwner = await managerContract.getChatroomOwner(activeChatroom);
                        setIsOwnerOfActiveChatroom(chatroomOwner.toLowerCase() === addr.toLowerCase());
                        const isMod = await managerContract.isModerator(activeChatroom, addr);
                        setIsModeratorOfActiveChatroom(isMod);
                    } else {
                        setIsOwnerOfActiveChatroom(false);
                        setIsModeratorOfActiveChatroom(false);
                    }

                } catch (error) {
                    console.error("Error fetching wallet data:", error);
                    showToast(`Failed to fetch wallet data: ${error.message.substring(0, 50)}...`, 'error');
                }
            }, [activeChatroom, walletAddress]); // Add walletAddress to deps for activeChatroom logic

            React.useEffect(() => {
                if (walletAddress) {
                    fetchWalletData(walletAddress);

                    if (window.ethereum) {
                        // Setup provider and listeners only once
                        if (!providerRef.current) {
                            const provider = new ethers.BrowserProvider(window.ethereum);
                            providerRef.current = provider;

                            // Listener for new blocks (to update balance/allowance)
                            provider.on('block', async (blockNumber) => {
                                console.log(`New block: ${blockNumber}. Refreshing wallet data.`);
                                fetchWalletData(walletAddress);
                            });

                            // Listener for account changes in MetaMask
                            window.ethereum.on('accountsChanged', async (accounts) => {
                                if (accounts.length === 0) {
                                    setWalletAddress(null);
                                    setVlcpBalance('0');
                                    setCurrentAllowance('0');
                                    setUserPair(null);
                                    setUserAlias('');
                                    showToast('Wallet disconnected or account changed.', 'info');
                                } else {
                                    setWalletAddress(accounts[0]);
                                    showToast(`Account changed to ${accounts[0].substring(0,6)}...`, 'info');
                                }
                                fetchWalletData(accounts[0]);
                            });

                            // Listener for network changes
                            window.ethereum.on('chainChanged', (chainId) => {
                                showToast(`Network changed to ${parseInt(chainId, 16)}. Please re-connect wallet.`, 'info', 7000);
                                setWalletAddress(null); // Force re-connect
                                setVlcpBalance('0');
                                setCurrentAllowance('0');
                                setUserPair(null);
                                setUserAlias('');
                            });
                        }
                    }
                }
                // Cleanup listeners on component unmount
                return () => {
                    if (providerRef.current) {
                        providerRef.current.removeAllListeners('block');
                    }
                    if (window.ethereum) {
                        window.ethereum.removeListener('accountsChanged', fetchWalletData); // Simpler cleanup
                        window.ethereum.removeListener('chainChanged', fetchWalletData);
                    }
                };
            }, [walletAddress, fetchWalletData]); // Rerun if walletAddress changes


            // --- Gun.js User Login/Logout/Nickname Management ---
            const generateGunUser = async () => {
                if (!loginPassword.trim()) {
                    showToast('Please enter a password to generate/login Gun.js user.', 'error');
                    return;
                }
                toggleLoading(true);
                showToast('Generating Gun.js identity...', 'info');
                try {
                    const pair = await SEA.pair();
                    // Save pair securely. For demo, just in memory or localStorage (NOT FOR PROD)
                    localStorage.setItem('gunUserPair', JSON.stringify(pair));
                    setUserPair(pair);
                    // Log in to Gun with username (public key) and password
                    gun.user().auth(pair, loginPassword, async (ack) => {
                        if (ack.err) {
                            showToast(`Gun.js auth error: ${ack.err}`, 'error');
                            console.error("Gun.js auth error:", ack.err);
                            setUserPair(null);
                            localStorage.removeItem('gunUserPair');
                        } else {
                            showToast('Gun.js identity created and logged in!', 'success');
                            setUserAlias(pair.pub.substring(0, 6)); // Default alias
                            setTempAlias(pair.pub.substring(0, 6));

                            // Try to load existing nickname for this public key
                            gun.get('user_profiles').get(pair.pub).get('nickname').once(data => {
                                if (data) {
                                    setUserAlias(data);
                                    setTempAlias(data);
                                    showToast(`Welcome back, ${data}!`, 'success');
                                }
                            });
                        }
                    });
                } catch (error) {
                    showToast(`Error generating identity: ${error.message}`, 'error');
                    console.error("Error generating identity:", error);
                } finally {
                    toggleLoading(false);
                }
            };

            const loginGunUser = async () => {
                if (!loginPassword.trim()) {
                    showToast('Please enter a password to generate/login Gun.js user.', 'error');
                    return;
                }
                toggleLoading(true);
                showToast('Logging into Gun.js identity...', 'info');
                try {
                    const storedPair = localStorage.getItem('gunUserPair');
                    if (storedPair) {
                        const pair = JSON.parse(storedPair);
                        gun.user().auth(pair, loginPassword, async (ack) => {
                            if (ack.err) {
                                showToast(`Gun.js login error: ${ack.err}. Try generating a new identity or check password.`, 'error');
                                console.error("Gun.js login error:", ack.err);
                                setUserPair(null);
                                localStorage.removeItem('gunUserPair');
                            } else {
                                setUserPair(pair);
                                setUserAlias(pair.pub.substring(0, 6)); // Default alias
                                setTempAlias(pair.pub.substring(0, 6));

                                // Load existing nickname
                                gun.get('user_profiles').get(pair.pub).get('nickname').once(data => {
                                    if (data) {
                                        setUserAlias(data);
                                        setTempAlias(data);
                                        showToast(`Welcome back, ${data}!`, 'success');
                                    } else {
                                        showToast('Logged into Gun.js. Set your nickname!', 'success');
                                    }
                                });
                            }
                        });
                    } else {
                        showToast('No stored identity found. Generate a new one.', 'info');
                    }
                } catch (error) {
                    showToast(`Error logging in: ${error.message}`, 'error');
                    console.error("Error logging in:", error);
                } finally {
                    toggleLoading(false);
                }
            };

            const logoutGunUser = () => {
                gun.user().leave();
                setUserPair(null);
                setUserAlias('');
                setTempAlias('');
                setLoginPassword('');
                localStorage.removeItem('gunUserPair');
                showToast('Logged out of Gun.js identity.', 'info');
            };

            const setNickname = async () => {
                if (!userPair) {
                    showToast('Please log in to your Gun.js identity first.', 'error');
                    return;
                }
                if (!tempAlias.trim()) {
                    showToast('Nickname cannot be empty.', 'error');
                    return;
                }
                if (tempAlias.trim().length > 20) {
                    showToast('Nickname too long (max 20 chars).', 'error');
                    return;
                }
                toggleLoading(true);
                showToast('Setting nickname...', 'info');
                try {
                    await new Promise((resolve, reject) => {
                        gun.get('user_profiles').get(userPair.pub).put({ nickname: tempAlias.trim() }, (ack) => {
                            if (ack.err) reject(ack.err);
                            else resolve();
                        });
                    });
                    setUserAlias(tempAlias.trim());
                    showToast(`Nickname set to '${tempAlias.trim()}'!`, 'success');
                } catch (error) {
                    showToast(`Failed to set nickname: ${error.message}`, 'error');
                    console.error("Error setting nickname:", error);
                } finally {
                    toggleLoading(false);
                }
            };


            // --- Ethers.js & Smart Contract Interactions ---
            const handleConnectWallet = async () => {
                try {
                    const { address } = await connectWallet();
                    setWalletAddress(address);
                    fetchWalletData(address);
                } catch (error) {
                    setWalletAddress(null);
                }
            };

            const handleMintTokens = async () => {
                if (!walletAddress) {
                    showToast('Please connect wallet first.', 'error'); return;
                }
                try {
                    toggleLoading(true);
                    showToast('Minting tokens (owner only)...', 'info');
                    const { signer } = await connectWallet();
                    const tokenContract = getVLCPTokenContract(signer);
                    const mintAmount = ethers.utils.parseUnits('1000', 18);
                    const tx = await tokenContract.mint(walletAddress, mintAmount);
                    showToast('Mint transaction sent. Waiting for confirmation...', 'info', 5000);
                    await tx.wait();
                    showToast('1000 VLCP tokens minted successfully!', 'success');
                    fetchWalletData(walletAddress);
                } catch (error) {
                    console.error("Error minting tokens:", error);
                    showToast(`Failed to mint tokens: ${error.message}`, 'error');
                } finally {
                    toggleLoading(false);
                }
            };

            const handleApproveTokens = async () => {
                if (!walletAddress) {
                    showToast('Please connect wallet first.', 'error'); return;
                }
                try {
                    toggleLoading(true);
                    showToast('Approving tokens for Chatroom Manager...', 'info');
                    const { signer } = await connectWallet();
                    const tokenContract = getVLCPTokenContract(signer);
                    const amountToApprove = ethers.constants.MaxUint256;
                    const tx = await tokenContract.approve(CHATROOM_MANAGER_CONTRACT_ADDRESS, amountToApprove);
                    showToast('Approval transaction sent. Confirm in MetaMask...', 'info', 5000);
                    await tx.wait();
                    showToast('Tokens approved successfully!', 'success');
                    fetchWalletData(walletAddress);
                } catch (error) {
                    console.error("Error approving tokens:", error);
                    showToast(`Failed to approve tokens: ${error.message}`, 'error');
                } finally {
                    toggleLoading(false);
                }
            };

            const handleCreateChatroom = async (e) => {
                e.preventDefault();
                if (!walletAddress) {
                    showToast('Please connect wallet first.', 'error'); return;
                }
                if (!chatroomName.trim()) {
                    showToast('Chatroom name cannot be empty.', 'error'); return;
                }
                if (chatroomName.trim().length > 30) {
                    showToast('Chatroom name too long (max 30 chars).', 'error'); return;
                }
                // Check if already exists in Gun (for immediate feedback, SC will also check)
                const existsOnGun = await new Promise(resolve => {
                    gun.get('chatrooms').get(chatroomName.trim()).once(data => {
                        resolve(!!data);
                    });
                });
                if (existsOnGun) {
                    showToast(`Chatroom '${chatroomName.trim()}' already exists.`, 'error');
                    return;
                }
                if (parseFloat(currentAllowance) < parseFloat(chatroomCreationFee)) {
                    showToast('Insufficient allowance. Please approve VLCP tokens first.', 'error'); return;
                }
                if (parseFloat(vlcpBalance) < parseFloat(chatroomCreationFee)) {
                    showToast('Insufficient VLCP balance.', 'error'); return;
                }

                try {
                    toggleLoading(true);
                    showToast(`Creating chatroom '${chatroomName.trim()}' on blockchain...`, 'info');
                    const { signer } = await connectWallet();
                    const managerContract = getChatroomManagerContract(signer);

                    const tx = await managerContract.createChatroom(chatroomName.trim());
                    showToast('Creation transaction sent. Waiting for confirmation...', 'info', 5000);
                    await tx.wait();

                    gun.get('chatrooms').get(chatroomName.trim()).put({ name: chatroomName.trim(), creator: walletAddress });
                    showToast(`Chatroom '${chatroomName.trim()}' created successfully!`, 'success');
                    setChatroomName('');
                    fetchChatroomList();
                    fetchWalletData(walletAddress);
                } catch (error) {
                    console.error("Error creating chatroom:", error);
                    showToast(`Failed to create chatroom: ${error.message}`, 'error');
                } finally {
                    toggleLoading(false);
                }
            };

            const fetchChatroomList = React.useCallback(() => {
                const fetchedRooms = [];
                gun.get('chatrooms').map().on(function(data, key) {
                    if (data && data.name) {
                        const existingIndex = fetchedRooms.findIndex(room => room.key === key);
                        if (existingIndex > -1) {
                            fetchedRooms[existingIndex] = { ...fetchedRooms[existingIndex], ...data, key: key };
                        } else {
                            fetchedRooms.push({ ...data, key: key });
                        }
                        setChatrooms([...fetchedRooms]);
                    }
                });
            }, []);

            React.useEffect(() => {
                if (currentPage === 'chatrooms') {
                    animatePageSectionEntry('.chatrooms-section');
                    applyInputFocusAnimation('.common-form input, .chat-input-area input');
                    fetchChatroomList();
                    const storedPair = localStorage.getItem('gunUserPair');
                    if (storedPair) {
                        setUserPair(JSON.parse(storedPair));
                        // Attempt to load alias if already logged in
                        const pair = JSON.parse(storedPair);
                        gun.get('user_profiles').get(pair.pub).get('nickname').once(data => {
                            if (data) {
                                setUserAlias(data);
                                setTempAlias(data);
                            } else {
                                setUserAlias(pair.pub.substring(0, 6));
                                setTempAlias(pair.pub.substring(0, 6));
                            }
                        });
                    }
                }
                return () => {
                    gun.get('chatrooms').map().off(); // Clean up Gun listener
                };
            }, [currentPage, fetchChatroomList]); // Add fetchChatroomList to dependencies


            const handleJoinChatroom = async (roomName) => {
                setActiveChatroom(roomName);
                setChatMessages([]);
                showToast(`Joined chatroom: ${roomName}`, 'info');

                if (walletAddress) {
                    const provider = new ethers.BrowserProvider(window.ethereum);
                    const managerContract = getChatroomManagerContract(provider);
                    const chatroomOwner = await managerContract.getChatroomOwner(roomName);
                    setIsOwnerOfActiveChatroom(chatroomOwner.toLowerCase() === walletAddress.toLowerCase());
                    const isMod = await managerContract.isModerator(roomName, walletAddress);
                    setIsModeratorOfActiveChatroom(isMod);
                }
            };

            const handleLeaveChatroom = () => {
                setActiveChatroom(null);
                setChatMessages([]);
                showToast('Left chatroom.', 'info');
            };

            const handleSendChatMessage = async () => {
                if (!chatInput.trim() || !activeChatroom || !userPair) {
                    showToast('Please log in to Gun.js and type a message.', 'error');
                    return;
                }
                const messageText = chatInput.trim();
                const timestamp = Date.now();
                const senderAlias = userAlias; // Use current alias

                // Store message in Gun.js
                gun.get(`chatroom_${activeChatroom}`).get('messages').set({
                    alias: senderAlias,
                    text: messageText,
                    timestamp: timestamp,
                    // signed: await SEA.sign(messageText, userPair) // Optional: for cryptographic message signing
                });
                setChatInput('');
            };

            const handleAddModerator = async (e) => {
                e.preventDefault();
                if (!walletAddress || !activeChatroom) {
                    showToast('Connect wallet and join a chatroom first.', 'error'); return;
                }
                if (!isOwnerOfActiveChatroom) {
                    showToast('Only the chatroom owner can add moderators.', 'error'); return;
                }
                if (!moderatorAddress.trim() || !ethers.utils.isAddress(moderatorAddress.trim())) {
                    showToast('Please enter a valid Ethereum address.', 'error'); return;
                }

                try {
                    toggleLoading(true);
                    showToast(`Adding ${moderatorAddress.trim()} as moderator...`, 'info');
                    const { signer } = await connectWallet();
                    const managerContract = getChatroomManagerContract(signer);

                    const tx = await managerContract.addModerator(activeChatroom, moderatorAddress.trim());
                    showToast('Moderator transaction sent. Waiting for confirmation...', 'info', 5000);
                    await tx.wait();
                    showToast(`${moderatorAddress.trim()} added as moderator to ${activeChatroom}!`, 'success');
                    setModeratorAddress('');
                    fetchWalletData(walletAddress);
                } catch (error) {
                    console.error("Error adding moderator:", error);
                    showToast(`Failed to add moderator: ${error.message}`, 'error');
                } finally {
                    toggleLoading(false);
                }
            };


            return React.createElement('section', { className: 'page-section card-3d chatrooms-section' },
                React.createElement('h2', null, 'Decentralized Chatrooms'),
                React.createElement('p', null, 'Connect with the VLCP community in real-time. Create your own chatroom for a fee in VLCP tokens or join existing ones. All chat messages are decentralized via Gun.js!'),

                React.createElement('div', { className: 'common-form' },
                    React.createElement('h3', null, 'Your Wallet & VLCP Tokens'),
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('button', { onClick: handleConnectWallet, disabled: walletAddress },
                            walletAddress ? `Connected: ${walletAddress.substring(0, 6)}...${walletAddress.slice(-4)}` : 'Connect Wallet (MetaMask)'
                        ),
                        walletAddress && React.createElement('p', null, React.createElement('strong', null, 'Wallet Address:'), ` ${walletAddress}`),
                        walletAddress && React.createElement('p', null, React.createElement('strong', null, 'VLCP Balance:'), ` ${vlcpBalance} VLCP`),
                        walletAddress && React.createElement('p', null, React.createElement('strong', null, 'Manager Allowance:'), ` ${currentAllowance} VLCP`),
                        React.createElement('p', null, React.createElement('strong', null, 'Creation Fee:'), ` ${chatroomCreationFee} VLCP`),
                    ),
                    walletAddress && React.createElement('div', { className: 'button-group' },
                        React.createElement('button', { onClick: handleMintTokens }, React.createElement('i', { className: 'fas fa-coins' }), ' Mint 1000 VLCP (Test)'),
                        React.createElement('button', { onClick: handleApproveTokens }, React.createElement('i', { className: 'fas fa-check-circle' }), ' Approve Tokens for Manager')
                    )
                ),

                React.createElement('div', { className: 'common-form' },
                    React.createElement('h3', null, 'Gun.js Chat Identity'),
                    !userPair ? (
                        React.createElement('div', null,
                            React.createElement('p', null, 'Create or log in to your decentralized chat identity. This allows you to send messages.'),
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', { htmlFor: 'loginPassword' }, 'Password (for Gun.js identity):'),
                                React.createElement('input', {
                                    type: 'password',
                                    id: 'loginPassword',
                                    value: loginPassword,
                                    onChange: (e) => setLoginPassword(e.target.value),
                                    placeholder: 'Keep this safe!'
                                })
                            ),
                            React.createElement('div', { className: 'button-group' },
                                React.createElement('button', { onClick: generateGunUser, disabled: !loginPassword.trim() }, React.createElement('i', { className: 'fas fa-user-plus' }), ' Generate New Identity'),
                                React.createElement('button', { onClick: loginGunUser, disabled: !loginPassword.trim() }, React.createElement('i', { className: 'fas fa-sign-in-alt' }), ' Login with Stored Identity')
                            )
                        )
                    ) : (
                        React.createElement('div', null,
                            React.createElement('p', null, React.createElement('strong', null, 'Logged in as:'), ` ${userAlias} (Public Key: ${userPair.pub.substring(0, 6)}...)`),
                            React.createElement('div', { className: 'form-group' },
                                React.createElement('label', { htmlFor: 'nickname' }, 'Set Your Nickname:'),
                                React.createElement('input', {
                                    type: 'text',
                                    id: 'nickname',
                                    value: tempAlias,
                                    onChange: (e) => setTempAlias(e.target.value),
                                    placeholder: 'e.g., Learner123'
                                })
                            ),
                            React.createElement('div', { className: 'button-group' },
                                React.createElement('button', { onClick: setNickname, disabled: !tempAlias.trim() || tempAlias.trim() === userAlias }, React.createElement('i', { className: 'fas fa-user-edit' }), ' Set Nickname'),
                                React.createElement('button', { onClick: logoutGunUser }, React.createElement('i', { className: 'fas fa-sign-out-alt' }), ' Logout Identity')
                            )
                        )
                    )
                ),

                React.createElement('div', { className: 'common-form' },
                    React.createElement('h3', null, 'Create New Chatroom'),
                    React.createElement('p', null, `Cost: ${chatroomCreationFee} VLCP tokens. Your wallet must be connected, have sufficient balance, and have approved the Chatroom Manager contract.`),
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', { htmlFor: 'newChatroomName' }, 'Chatroom Name:'),
                        React.createElement('input', {
                            type: 'text',
                            id: 'newChatroomName',
                            value: chatroomName,
                            onChange: (e) => setChatroomName(e.target.value),
                            placeholder: 'e.g., IslamicFinanceChat'
                        })
                    ),
                    React.createElement('button', { onClick: handleCreateChatroom, disabled: !walletAddress || parseFloat(vlcpBalance) < parseFloat(chatroomCreationFee) || parseFloat(currentAllowance) < parseFloat(chatroomCreationFee) || !chatroomName.trim() },
                        React.createElement('i', { className: 'fas fa-comments' }), ` Create Chatroom (${chatroomCreationFee} VLCP)`
                    )
                ),

                !activeChatroom ? (
                    React.createElement('div', null,
                        React.createElement('h3', { style: { textAlign: 'center', marginTop: '2rem' } }, 'Available Chatrooms'),
                        chatrooms.length > 0 ? (
                            React.createElement('div', { className: 'chatrooms-list' },
                                chatrooms.map((room) =>
                                    React.createElement('div', { key: room.key, className: 'chatroom-card' },
                                        React.createElement('h3', null, room.name),
                                        React.createElement('p', null, `Created by: ${room.creator.substring(0, 6)}...${room.creator.slice(-4)}`),
                                        React.createElement('button', { onClick: () => handleJoinChatroom(room.name) }, React.createElement('i', { className: 'fas fa-arrow-right' }), ' Join Chat')
                                    )
                                )
                            )
                        ) : (
                            React.createElement('p', { style: { textAlign: 'center', marginTop: '1rem' } }, 'No chatrooms created yet. Be the first!')
                        )
                    )
                ) : (
                    React.createElement('div', { className: 'active-chatroom' },
                        React.createElement('h3', { style: { margin: '0', padding: '1rem', backgroundColor: 'var(--primary-color)', color: 'white', display: 'flex', justifyContent: 'space-between', alignItems: 'center' } },
                            React.createElement('span', null, React.createElement('i', { className: 'fas fa-hashtag' }), ` ${activeChatroom}`),
                            React.createElement('button', { onClick: handleLeaveChatroom, style: { background: 'none', border: '1px solid white', color: 'white', padding: '0.5rem 1rem', fontSize: '0.8em' } }, React.createElement('i', { className: 'fas fa-sign-out-alt' }), ' Leave')
                        ),
                        React.createElement('div', { className: 'chat-messages-display' },
                            chatMessages.map((msg, index) =>
                                React.createElement('div', { key: msg.key || index, className: `chat-message ${msg.alias === userAlias ? 'self' : 'other'}` },
                                    React.createElement('div', { className: 'message-header' },
                                        React.createElement('strong', null, msg.alias),
                                        React.createElement('span', null, new Date(msg.timestamp).toLocaleTimeString())
                                    ),
                                    React.createElement('div', { className: 'message-body' }, msg.text)
                                )
                            ),
                            React.createElement('div', { ref: messagesEndRef })
                        ),
                        React.createElement('div', { className: 'chat-input-area' },
                            React.createElement('input', {
                                type: 'text',
                                value: chatInput,
                                onChange: (e) => setChatInput(e.target.value),
                                onKeyPress: (e) => { if (e.key === 'Enter') handleSendChatMessage(); },
                                placeholder: userPair ? 'Type your message...' : 'Login to chat identity to send messages'
                            }),
                            React.createElement('button', { onClick: handleSendChatMessage, disabled: !userPair || !chatInput.trim() }, React.createElement('i', { className: 'fas fa-paper-plane' }), ' Send')
                        ),
                        (isOwnerOfActiveChatroom || isModeratorOfActiveChatroom) && React.createElement('div', { className: 'chatroom-admin-section' },
                            React.createElement('h3', null, React.createElement('i', { className: 'fas fa-tools' }), ' Moderator Tools'),
                            isOwnerOfActiveChatroom && React.createElement('div', { className: 'common-form', style: { maxWidth: '400px', margin: '1rem auto', padding: '1rem' } },
                                React.createElement('h4', null, 'Add Moderator'),
                                React.createElement('div', { className: 'form-group' },
                                    React.createElement('label', { htmlFor: 'moderatorAddress' }, 'Moderator Wallet Address:'),
                                    React.createElement('input', {
                                        type: 'text',
                                        id: 'moderatorAddress',
                                        value: moderatorAddress,
                                        onChange: (e) => setModeratorAddress(e.target.value),
                                        placeholder: '0x...'
                                    })
                                ),
                                React.createElement('button', { onClick: handleAddModerator, disabled: !moderatorAddress.trim() || !ethers.utils.isAddress(moderatorAddress.trim()) }, React.createElement('i', { className: 'fas fa-user-shield' }), ' Add Moderator')
                            ),
                            React.createElement('p', { style: { fontSize: '0.9em', color: 'var(--text-color)' } },
                                `You are ${isOwnerOfActiveChatroom ? 'the Chatroom Owner' : ''}${isOwnerOfActiveChatroom && isModeratorOfActiveChatroom ? ' and ' : ''}${isModeratorOfActiveChatroom ? 'a Chatroom Moderator' : ''} for this room.`
                            )
                        )
                    )
                )
            );
        };


        // 4.6. Main App Component
        const App = () => {
            const { theme, toggleTheme } = useTheme();
            const [currentPage, setCurrentPage] = React.useState('home');
            const [isChatbotOpen, setIsChatbotOpen] = React.useState(false);
            const [showMobileNav, setShowMobileNav] = React.useState(false);
            const mainContentRef = React.useRef(null);
            const meshRef = React.useRef(null);
            const scrollToTopBtnRef = React.useRef(null);

            // Parallax effect for background mesh
            React.useEffect(() => {
                const parallaxTween = gsap.to(meshRef.current, {
                    yPercent: -10,
                    ease: "none",
                    scrollTrigger: {
                        trigger: "body",
                        start: "top top",
                        end: "bottom top",
                        scrub: true,
                    }
                });
                gsap.to(meshRef.current, {
                    backgroundPositionX: '+=100%',
                    backgroundPositionY: '+=100%',
                    duration: 60,
                    repeat: -1,
                    ease: 'none'
                });
                return () => parallaxTween.kill();
            }, []);

            // Dynamic Network Particles
            React.useEffect(() => {
                const createParticle = () => {
                    const particle = document.createElement('div');
                    particle.className = 'network-particle';
                    document.body.appendChild(particle);

                    const size = gsap.utils.random(5, 15);
                    const startX = gsap.utils.random(0, window.innerWidth);
                    const startY = gsap.utils.random(0, window.innerHeight);
                    const endX = gsap.utils.random(0, window.innerWidth);
                    const endY = gsap.utils.random(0, window.innerHeight);
                    const duration = gsap.utils.random(10, 20);

                    gsap.set(particle, {
                        x: startX,
                        y: startY,
                        width: size,
                        height: size,
                        opacity: 0
                    });

                    gsap.to(particle, {
                        opacity: 0.5,
                        duration: 1,
                        ease: 'power1.out'
                    });

                    gsap.to(particle, {
                        x: endX,
                        y: endY,
                        duration: duration,
                        ease: 'none',
                        repeat: -1,
                        yoyo: true,
                        onComplete: () => particle.remove()
                    });

                    gsap.to(particle, {
                        opacity: 0,
                        delay: duration - 1,
                        duration: 1,
                        ease: 'power1.in'
                    });
                };

                const particleInterval = window.innerWidth < 768 ? 1000 : 500;
                let intervalId;

                if (window.innerWidth > 480) {
                    intervalId = setInterval(createParticle, particleInterval);
                }
                return () => {
                    if (intervalId) clearInterval(intervalId);
                };
            }, []);

            // Scroll-to-top logic
            React.useEffect(() => {
                const toggleVisibility = () => {
                    if (window.pageYOffset > 300) {
                        gsap.to(scrollToTopBtnRef.current, { opacity: 1, visibility: 'visible', duration: 0.3 });
                    } else {
                        gsap.to(scrollToTopBtnRef.current, { opacity: 0, visibility: 'hidden', duration: 0.3 });
                    }
                };
                window.addEventListener('scroll', toggleVisibility);
                return () => window.removeEventListener('scroll', toggleVisibility);
            }, []);

            const scrollToTop = () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            };

            const handlePageChange = (newPage) => {
                if (mainContentRef.current) {
                    gsap.to(mainContentRef.current, {
                        opacity: 0,
                        y: 50,
                        scale: 0.95,
                        duration: 0.4,
                        ease: 'power2.in',
                        onComplete: () => {
                            setCurrentPage(newPage);
                            gsap.fromTo(mainContentRef.current,
                                { opacity: 0, y: -50, scale: 0.95 },
                                { opacity: 1, y: 0, scale: 1, duration: 0.6, ease: 'power2.out' }
                            );
                            if (showMobileNav) setShowMobileNav(false);
                        }
                    });
                } else {
                    setCurrentPage(newPage);
                    if (showMobileNav) setShowMobileNav(false);
                }
            };

            const toggleMobileNav = () => {
                setShowMobileNav(prev => !prev);
            };

            const renderPage = () => {
                switch (currentPage) {
                    case 'home':
                        return React.createElement(HomePage, { currentPage });
                    case 'courses':
                        return React.createElement(CoursesPage, { currentPage });
                    case 'webinars':
                        return React.createElement(WebinarsPage, { currentPage });
                    case 'chatrooms':
                        return React.createElement(ChatroomsPage, { currentPage });
                    case 'about-us':
                        return React.createElement(AboutUsPage, { currentPage });
                    case 'issue-certificate':
                        return React.createElement(CertificateIssuer, { currentPage: 'certificate-issuer' });
                    case 'verify-certificate':
                        return React.createElement(CertificateVerifierPage, { currentPage: 'certificate-verifier' });
                    default:
                        return React.createElement(HomePage, { currentPage });
                }
            };

            return React.createElement('div', { className: 'app-container' },
                React.createElement('div', { className: 'animated-background-mesh', ref: meshRef }),
                React.createElement('header', { className: 'app-header' },
                    React.createElement('img', {
                        src: 'assets/vlcp_logo.png',
                        alt: 'VLCP Logo',
                        className: 'logo',
                        onClick: () => handlePageChange('home')
                    }),
                    React.createElement('nav', { className: 'main-nav' },
                        React.createElement('button', { onClick: () => handlePageChange('home'), className: currentPage === 'home' ? 'active' : '' }, 'Home'),
                        React.createElement('button', { onClick: () => handlePageChange('courses'), className: currentPage === 'courses' ? 'active' : '' }, 'Courses & Resources'),
                        React.createElement('button', { onClick: () => handlePageChange('webinars'), className: currentPage === 'webinars' ? 'active' : '' }, 'Webinars & Events'),
                        React.createElement('button', { onClick: () => handlePageChange('chatrooms'), className: currentPage === 'chatrooms' ? 'active' : '' }, 'Chatrooms'),
                        React.createElement('button', { onClick: () => handlePageChange('issue-certificate'), className: currentPage === 'issue-certificate' ? 'active' : '' }, 'Issue Cert'),
                        React.createElement('button', { onClick: () => handlePageChange('verify-certificate'), className: currentPage === 'verify-certificate' ? 'active' : '' }, 'Verify Cert'),
                        React.createElement('button', { onClick: () => handlePageChange('about-us'), className: currentPage === 'about-us' ? 'active' : '' }, 'About Us')
                    ),
                    React.createElement('button', { className: 'theme-toggle', onClick: toggleTheme },
                        `Switch to ${theme === 'dark' ? 'Light' : 'Dark'} Mode`
                    ),
                    React.createElement('button', { className: 'hamburger-menu', onClick: toggleMobileNav, 'aria-label': 'Toggle navigation menu' },
                        React.createElement('i', { className: showMobileNav ? 'fas fa-times' : 'fas fa-bars' })
                    )
                ),
                React.createElement('div', { className: `mobile-nav-overlay ${showMobileNav ? 'open' : ''}` },
                    React.createElement('nav', { className: 'main-nav' },
                        React.createElement('button', { onClick: () => handlePageChange('home'), className: currentPage === 'home' ? 'active' : '' }, 'Home'),
                        React.createElement('button', { onClick: () => handlePageChange('courses'), className: currentPage === 'courses' ? 'active' : '' }, 'Courses & Resources'),
                        React.createElement('button', { onClick: () => handlePageChange('webinars'), className: currentPage === 'webinars' ? 'active' : '' }, 'Webinars & Events'),
                        React.createElement('button', { onClick: () => handlePageChange('chatrooms'), className: currentPage === 'chatrooms' ? 'active' : '' }, 'Chatrooms'),
                        React.createElement('button', { onClick: () => handlePageChange('issue-certificate'), className: currentPage === 'issue-certificate' ? 'active' : '' }, 'Issue Cert'),
                        React.createElement('button', { onClick: () => handlePageChange('verify-certificate'), className: currentPage === 'verify-certificate' ? 'active' : '' }, 'Verify Cert'),
                        React.createElement('button', { onClick: () => handlePageChange('about-us'), className: currentPage === 'about-us' ? 'active' : '' }, 'About Us')
                    ),
                    React.createElement('button', { className: 'theme-toggle', onClick: toggleTheme },
                        `Switch to ${theme === 'dark' ? 'Light' : 'Dark'} Mode`
                    )
                ),
                React.createElement('main', { className: 'main-content', ref: mainContentRef },
                    renderPage()
                ),
                React.createElement('footer', { className: 'app-footer' },
                    React.createElement('p', null, '© 2024 VLCP. Virtual Learning & Community Platform. All rights reserved.')
                ),
                React.createElement(Chatbot, { isOpen: isChatbotOpen, setIsOpen: setIsChatbotOpen }),
                React.createElement('button', { id: 'scrollToTopBtn', className: 'scroll-to-top', onClick: scrollToTop, ref: scrollToTopBtnRef },
                    React.createElement('i', { className: 'fas fa-arrow-up' })
                ),
                React.createElement('button', { className: `chatbot-toggle-button ${isChatbotOpen ? 'hide' : ''}`, onClick: () => setIsChatbotOpen(true) }, '💬')
            );
        };

        // 4.7. Root Render Call
        const rootElement = document.getElementById('root');
        ReactDOM.createRoot(rootElement).render(
          <React.StrictMode>
            <ThemeProvider>
              <App />
            </ThemeProvider>
          </React.StrictMode>
        );

    </script>
</body>
</html>
